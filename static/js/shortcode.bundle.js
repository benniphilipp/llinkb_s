(()=>{"use strict";function e(e){const t=gettext("Report");$("#toast-alert").html(`\n        <div class="ls-toast" id="ls-toas">\n            <div class="ls-toas-header d-flex justify-content-start align-items-center px-2 py-2">\n                <svg class="bd-placeholder-img rounded me-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#007aff"></rect></svg>\n                <span><b>${t}</b></span>\n                <i class="fa-solid fa-xmark ms-auto"></i>\n            </div>\n            <hr>\n            <div class="ls-toas-body p-2">\n                ${e}\n            </div>\n        </div>\n    `),setTimeout((function(){$("#toast-alert").html("")}),4e3)}const t=class{constructor(){this.ShortccodeEvents(),this.ShortcodeAjaxView(1)}ShortccodeEvents(){const e=document.querySelector("#crate-form-shortcode");e&&e.addEventListener("click",this.ShortcodeCrateView.bind(this));const t=document.querySelector("#update-form-shortcode");t&&t.addEventListener("click",this.ShortcodeUpdateCrateView.bind(this));const o=this,n=document.getElementById("shortcode-list");n&&n.addEventListener("click",(function(e){if(e.target.classList.contains("shortcode-class")){const t=e.target.getAttribute("data-shortcode");o.ShortcodeUpdateView(t)}}));const s=document.querySelector("#id_url_destination");s&&s.addEventListener("input",this.ShortcodeUrlAccessibility.bind(this));const c=document.getElementById("id_url_titel");c&&c.addEventListener("input",(function(){const e=this.value,t=document.getElementById("id_url_destination").value,o=document.getElementById("crate-form-shortcode"),n=document.getElementById("update-form-shortcode");o&&e&&t&&o.classList.remove("disabled"),n&&e&&t&&n.classList.remove("disabled")})),n&&n.addEventListener("click",(function(e){if(e.target.classList.contains("btn-copy")){const t=e.target.getAttribute("data-button");o.CopyButtonColort(t)}}));const r=document.querySelector("#aside-form");r&&r.addEventListener("click",(function(e){if(e.target.classList.contains("btn-copy")){const t=e.target.getAttribute("data-button");o.CopyButtonColort(t)}}));const a=document.querySelector("#load-more-button");if(a){let e=1;a.addEventListener("click",function(){e+=1,this.ShortcodeAjaxView(e)}.bind(this))}const d=document.querySelector("#filter-search-form");if(d){let e=1;d.addEventListener("change",function(){const t=this;setTimeout((function(){t.ShortcodeAjaxView(e)}),300);const o=document.querySelector("#shortcode-list");for(;o.firstChild;)o.removeChild(o.firstChild);const n=document.getElementById("alertUser");for(;n.firstChild;)n.removeChild(n.firstChild)}.bind(this))}}CopyButtonColort(e){let t=document.getElementById(e);navigator.clipboard.writeText(t?.innerText).then((e=>{})),$(".color"+e).addClass("bg-success text-white"),setTimeout((()=>{$(".color"+e).removeClass("bg-success text-white"),console.clear()}),2e3)}ShortcodeUrlAccessibility(){const e=document.querySelector("#id_url_destination").value,t=document.querySelector("#CheckingUrlAccessibility").value,o="?url="+encodeURIComponent(e);document.querySelector("#id_url_destination"),$.ajax({url:t+o,type:"GET",dataType:"json",success:e=>{console.log(e),"true"===e[0].data?($("#id_url_destination").after('<div class="text-success">Deine Website ist erreichbar!</div>'),setTimeout((()=>{$("#id_url_destination").next().remove()}),2e3)):($("#id_url_destination").after('<div class="text-danger">Deine Website ist erreichbar!</div>'),setTimeout((()=>{$("#id_url_destination").next().remove()}),2e3))},error:e=>{console.log(e)}})}ShortcodeUpdateView(e){const t=document.querySelector("#overlay-open"),o=document.querySelector("#aside-form");document.querySelector("#crate-form-shortcode").classList.add("d-none"),t.classList.add("overlay-open"),o.classList.add("toggle");const n=document.getElementById("ShortcodeSingelUpdateView").value.replace(/0/g,e);document.getElementById("archive-btn").setAttribute("data-archive",e);const s=document.getElementById("id_url_destination"),c=document.getElementById("id_url_titel"),r=document.getElementById("id_shortcode"),a=document.querySelector("#shortcode_id"),d=document.querySelector("#update-shortcode-url"),i=document.getElementById("update-form-shortcode");c&&s&&i.classList.remove("disabled"),$.ajax({type:"GET",url:n,success:e=>{const t=e.data;s.value=t.url_destination,c.value=t.url_titel,r.value=t.shortcode,d.value=t.id;const o=$('input[name="tags"][type="checkbox"]');o.each((function(e,o){const n=parseInt($(o).val()),s=t.tags.includes(n);$(o).prop("checked",s)})),o.trigger("change"),a.innerHTML=`<button data-button="short${t.id}" type="button" class="btn btn-secondary btn-copy colorshort${t.id} btn-sm"><i class="fa-solid fa-link"></i> Kopieren</button>`},error:e=>{console.log(e)}})}ShortcodeUpdateCrateView(t){t.preventDefault();const o=document.getElementById("alertUser");for(;o.firstChild;)o.removeChild(o.firstChild);const n=document.querySelector("#update-shortcode-url").value,s=document.getElementById("ShortcodeSingelUpdateView").value.replace(/0/g,n),c=document.getElementsByName("csrfmiddlewaretoken"),r=document.getElementById("id_url_destination"),a=document.getElementById("id_url_titel"),d=document.getElementById("id_shortcode"),i=new FormData;i.append("csrfmiddlewaretoken",c[0].value),i.append("url_destination",r.value),i.append("shortcode_id",d.value),i.append("url_titel",a.value);const l=[];document.querySelectorAll('input[name="tags"]:checked').forEach((function(e){l.push(e.value)})),i.append("tags",l.join(",")),$.ajax({type:"POST",url:s,data:i,dataType:"json",cache:!1,contentType:!1,processData:!1,success:t=>{document.getElementById("archive-btn").setAttribute("data-archive",""),r.value="",a.value="",d.value="";const o=document.querySelector("#overlay-open"),n=document.querySelector("#aside-form");document.querySelector("#crate-form-shortcode").classList.remove("d-none"),o.classList.remove("overlay-open"),n.classList.remove("toggle"),$('input[name="tags"][type="checkbox"]').each((function(e,t){parseInt($(t).val()),$(t).prop("checked","")}));const s=document.querySelector("#shortcode-list");for(;s.firstChild;)s.removeChild(s.firstChild);e(t.success),setTimeout((()=>{this.ShortcodeAjaxView(1)}),200)},error:e=>{console.log(e)}})}ShortcodeCrateView(t){t.preventDefault();const o=document.querySelector('input[name="data"]'),n=document.getElementById("id_url_destination"),s=document.getElementById("id_url_titel"),c=document.getElementById("id_shortcode"),r=document.getElementById("url_creator"),a=document.getElementsByName("csrfmiddlewaretoken"),d=document.getElementById("alertUser");for(;d.firstChild;)d.removeChild(d.firstChild);const i=new FormData;i.append("csrfmiddlewaretoken",a[0].value),i.append("url_destination",n.value),i.append("url_titel",s.value),i.append("id_shortcode",c.value),i.append("url_creator",r.value),$.ajax({type:"POST",url:o.value,data:i,dataType:"json",success:t=>{console.log(t);const o=document.getElementById("openForm"),n=document.querySelector("#overlay-open"),s=document.querySelector("#aside-form"),c=document.querySelector("#crate-form-shortcode");o.classList.remove("disabled"),c.classList.remove("d-none"),n.classList.remove("overlay-open"),s.classList.remove("toggle"),$('input[name="tags"][type="checkbox"]').each((function(e,t){parseInt($(t).val()),$(t).prop("checked","")}));const r=document.querySelector("#shortcode-list");for(;r.firstChild;)r.removeChild(r.firstChild);e(t.success),setTimeout((()=>{this.ShortcodeAjaxView(1)}),300)},error:(e,t,o)=>{console.error("Fehler:",o)},cache:!1,contentType:!1,processData:!1})}ShortcodeAjaxView(e){const t=document.querySelector('input[name="data"]');if(t){const o=document.querySelector("#gif-load"),n=document.querySelector("#tag-filter"),s=document.querySelector("#search-input"),c=n.value,r=s.value;let a,d=0;const i=c?[c]:[];$.ajax({url:`${t.value}?page=${e}`,type:"GET",data:{page:e},dataType:"json",data:{tags:i,q:r},success:t=>{const n=document.getElementById("alertUser");n.querySelector(".alert")||(n.innerHTML+=`\n                            <div class="alert alert-${t.user_date.alert} d-inline-flex p-2" role="alert">\n                                ${t.user_date.message}\n                            </div>\n                        `),"warning"===t.user_date.alert&&(document.querySelector("#openForm").style.display="none");const s=document.querySelector("#shortcode-list"),c=t.data;o.classList.remove("d-none"),setTimeout((function(){c.forEach((function(e){const t=e.get_short_url.length>90?e.get_short_url.substring(0,90)+"...":e.get_short_url,o=e.url_destination.length>90?e.url_destination.substring(0,90)+"...":e.url_destination,n=e.short_id,c=e.url_create_date,r=e.click_count,a=e.shortcode,d=e.tags,i=e.url_titel;let l=e.favicon_path;"null"!==l&&null!==l||(l=document.querySelector("#favicon-path").value);const u=gettext("edit"),m=gettext("clicks"),h=gettext("copy"),g=document.createElement("div");g.innerHTML=`\n                                <div class="card p-3 my-3 border border-0 shadow-sm">\n                                    <div class="card-header header-elements">\n                                        <form id="shortcode-form">\n                                            <input type="checkbox" name="selected_shortcodes" value="shortcode_id_${n}">\n                                        </form>\n                                        <img src="${l}" class="img-thumbnail favicon-img" alt="favicon.ico">\n                                        <h5 class="card-title">${i}</h5>\n                                        <div class="card-header-elements ms-auto">\n                                            <span class="d-none" id="short${n}">${t}</span>\n                                            <button data-button="short${n}" type="button" class="btn btn-secondary btn-copy colorshort${n} btn-sm">\n                                                <i class="fa-regular fa-copy"></i> ${h}\n                                            </button>\n                                            <a data-shortcode="${n}" data-shortname="${a}" class="shortcode-class short-name btn btn-xs btn-primary btn-sm">\n                                                <i class="fa-solid fa-pencil"></i> ${u}\n                                            </a>\n                                        </div>\n                                    </div>\n                                    <div class="card-body">\n                                        <a href="${t}">${t}</a><br>\n                                        <a class="text-muted" href="${o}">${o}</a>\n                                    </div>\n                                    <div class="card-footer">\n                                        <small class="text-muted short-links-footer">\n                                            <span class="short-calendar"><i class="fa-regular fa-calendar orb-icon"></i> ${c} </span>\n                                            <span class="short-chart" data-anaylyse="${n}">\n                                                <i class="fa-solid fa-chart-line orb-icon"></i> ${r} ${m}\n                                            </span>\n                                            <span class="short-tags"><i class="fa-solid fa-tag orb-icon"></i> ${d.join(", ")} Tags</span>\n                                        </small>\n                                    </div>\n                                </div>\n                            `,s.appendChild(g)}));const n=gettext("Your search returned no results, please try again.");0===c.length&&(s.innerHTML=`\n                            <div class="alert alert-primary" role="alert">\n                                ${n}\n                            </div>\n                            `),o.classList.add("d-none");const r=document.querySelector("#load-more-button");r.classList.remove("d-none"),0===d&&(d=t.total_shortcodes),0===c.length||t.page*t.per_page>=d?r.classList.add("d-none"):r.classList.remove("d-none"),e+=1,a=t.start_index}),1e3)},error:(e,t,o)=>{console.error(o)}})}}};function o(e){let t=null;if(document.cookie&&""!==document.cookie){const o=document.cookie.split(";");for(let n=0;n<o.length;n++){const s=o[n].trim();if(s.substring(0,e.length+1)===e+"="){t=decodeURIComponent(s.substring(e.length+1));break}}}return t}const n=class{constructor(){this.csrftoken=o("csrftoken"),this.EventTags(),this.LoadTags()}EventTags(){const e=document.querySelector("#exampleModal");e&&e.addEventListener("click",(function(){document.querySelector("#model-form-tag").classList.add("active")}));const t=document.querySelector("#createTagButton");t&&t.addEventListener("click",this.CrateShortcodeTags.bind(this));const o=document.querySelector("#tag-edit");o&&o.addEventListener("click",this.EditTagsView.bind(this));const n=this,s=document.getElementById("tag-list-edit");s&&s.addEventListener("click",(function(e){if(e.target.classList.contains("edit-tag-button")){const t=e.target.getAttribute("data-tag-id");n.EditTags(t)}}));const c=document.querySelector("#tag-close");c&&c.addEventListener("click",this.TagModelClose.bind(this)),s&&s.addEventListener("click",(function(e){if(e.target.classList.contains("delete-tag-button")){const t=e.target.getAttribute("data-tag-id");n.DeleteTag(t)}}))}DeleteTag(t){const o=document.getElementById("tag_delete").value.replace(/0/g,t);$.ajax({url:o,method:"POST",headers:{"X-CSRFToken":this.csrftoken},success:t=>{console.log(t),e(t.message),this.LoadTags(),this.EditTagsView()},error:e=>{console.log(e)}})}TagModelClose(){const e=document.querySelector(".form-tag-view"),t=document.querySelector("#tag-list-edit"),o=document.querySelector("#id_name"),n=document.querySelector("#tag-edit"),s=document.querySelector(".icon-modal-right"),c=document.querySelector("#model-form-tag"),r=gettext("Delete or edit tags");e.style.display="block",t.style.display="none",o.value="",n.innerHTML=`<span id="tag-edit">${r}</span>`,s.style.display="block",c.classList.remove("active")}EditTags(t){const o=document.querySelector("#tag-value"+t).value,n=document.getElementById("tag_edit").value.replace(/0/g,t);console.log(n),$.ajax({type:"POST",url:n,headers:{"X-CSRFToken":this.csrftoken},data:{tag_name:o},success:t=>{e(t.message),this.LoadTags()},error:e=>{console.log(e)}})}EditTagsView(){const e=document.querySelector("#TagListView");if(e){const t=e.value,o=document.querySelector(".form-tag-view"),n=document.querySelector("#tag-list-edit"),s=document.querySelector(".icon-modal-right"),c=document.querySelector("#tag-edit");o.style.display="none",n.style.display="block",s.style.display="none",c.innerHTML="";const r=gettext("delete"),a=gettext("save Changes");$.ajax({url:t,method:"GET",success:e=>{const t=e.tags;let o="";t.forEach((e=>{o+=`\n                    <div class="input-group mb-3" id="tag-${e.id}">\n                        <input type="text" class="form-control" id="tag-value${e.id}" value="${e.name}" placeholder="">\n                        <button class="btn btn-outline-danger delete-tag-button" type="button" data-tag-id="${e.id}">${r}</button>\n                        <button class="btn btn-outline-primary edit-tag-button" type="button" data-tag-id="${e.id}">${a}</button>\n                    </div>`})),n.innerHTML=o},error:e=>{console.log(e)}})}}LoadTags(){const e=document.querySelector("#get_all_tags");if(e){const t=e.value;$.ajax({type:"GET",url:t,success:e=>{const t=e.tags,o=document.querySelector("#tag-filter"),n=document.createElement("option");n.text="Tag Wählen...",n.value="",o.innerHTML="",o.appendChild(n),t.forEach((function(e){const t=document.createElement("option");t.text=e,t.value=e,o.appendChild(t)}))},error:e=>{console.log(e)}})}}CrateShortcodeTags(t){t.preventDefault();const o=document.querySelector("#CreateTagView").value,n=document.querySelector("#model-form-tag"),s=document.querySelector("#id_name"),c=$("#id_name").val(),r=$('[name="csrfmiddlewaretoken"]').val();$.ajax({type:"POST",url:o,data:{tag_name:c,csrfmiddlewaretoken:r},success:t=>{e(t.message),this.LoadTags(),s.value="",n.classList.remove("active")},error:(e,t,o)=>{console.log(e,t,o)}})}},s=class{constructor(){this.csrftoken=o("csrftoken"),this.ExportEvents()}ExportEvents(){const e=document.querySelector("#export-button");e&&e.addEventListener("click",this.ExportFunc.bind(this))}ExportFunc(){const e=document.querySelector("#export_shortcodes_to_excel").value;let t=[];$('input[name="selected_shortcodes"]:checked').each((function(){t.push($(this).val())})),$.ajax({url:e,method:"POST",data:{"selected_ids[]":t},headers:{"X-CSRFToken":this.csrftoken},success:function(e){var t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=window.URL.createObjectURL(t),o.download="shortcodes.xlsx",o.click(),console.log(e)},error:function(e,t,o){console.error(o)}})}},c=class{constructor(){this.csrftoken=o("csrftoken"),this.events()}events(){const e=this,t=document.querySelector("#archive-btn");t&&t.addEventListener("click",(function(t){if(t.target.classList.contains("archive-class-btn")){const o=t.target.getAttribute("data-archive");e.ShortcodeArchiveren(o)}}));const o=document.querySelector("#ArchivListLiftView");o&&this.ArchiveListView(o);const n=document.querySelector("#delete-button");n&&n.addEventListener("click",this.ShortcodeDelete.bind(this));const s=document.querySelector("#archive-button");s&&s.addEventListener("click",this.ShortcodeUnarchive.bind(this))}ShortcodeUnarchive(){const t=document.querySelector("#ShortcodeUnarchived");if(t){const o=t.value,n=[];$('input[type="checkbox"]:checked').each((function(){const e=$(this).closest("tr").data("shortcode");n.push(e)})),$.ajax({type:"POST",url:o,data:{selected_shortcodes:n},headers:{"X-CSRFToken":this.csrftoken},success:t=>{e(t.message);const o=document.querySelector("#ArchivListLiftView").value;this.ArchiveListView(o)},error:e=>{console.log(e)}})}}ShortcodeDelete(){const t=[];$('input[type="checkbox"]:checked').each((function(){const e=$(this).attr("id").split("-")[1];t.push(e)}));const o=document.querySelector("#ArchivListLiftView").value,n=gettext("Please select at least one shortcode to delete.");0!==t.length?$.ajax({type:"POST",url:o,data:{"shortcode_ids[]":t},headers:{"X-CSRFToken":this.csrftoken},success:t=>{e(t.message),this.ArchiveListView(o)},error:e=>{console.log(e)}}):e(n)}ArchiveListView(e){const t=e.value;$.ajax({type:"GET",url:t,dataType:"json",success:e=>{const t=e.archived_shortcodes,o=$("#archived-shortcode-table");o.empty(),t.forEach((function(e){const t=$('<tr data-shortcode="'+e.id+'" class="shortcode-class">').addClass("shortcode-class"),n=$("<td>"),s=$("<input>").attr({type:"checkbox",value:e.id,id:"checkbox-"+e.id}).addClass("form-check-input");n.append(s),t.append(n);const c=$("<td>").text(e.url_titel),r=$("<td>").text(e.url_destination),a=$("<td>").text(e.url_create_date);t.append(c),t.append(r),t.append(a),o.append(t)}))},error:e=>{console.log(e)}})}ShortcodeArchiveren(o){const n=this,s=document.getElementById("ShortcodeAcivieren").value.replace(/0/g,o),c=document.querySelector("#alertUser");for(;c.firstChild;)c.removeChild(c.firstChild);$.ajax({type:"GET",url:s,headers:{"X-CSRFToken":this.csrftoken},success:o=>{setTimeout((()=>{const e=document.querySelector("#overlay-open"),t=document.querySelector("#aside-form");document.querySelector("#crate-form-shortcode").classList.remove("d-none"),e.classList.remove("overlay-open"),t.classList.remove("toggle")}),300),setTimeout((()=>{this.shortcodeview=new t,n.shortcodeview.ShortcodeAjaxView(1)}),400),e(o.success)},error:e=>{console.log(e)}})}};document.addEventListener("DOMContentLoaded",(function(){new t,new n,new s,new c}));const r=document.querySelector("#openForm");r&&r.addEventListener("click",(function(){const e=document.querySelector("#aside-form"),t=document.querySelector("#archive-btn"),o=document.querySelector("#update-form-shortcode"),n=document.querySelector("#openForm"),s=document.querySelector("#overlay-open"),c=document.querySelector("#pills-profile-tab"),r=document.querySelector("#limitation-form"),a=document.querySelector("#mobile-tab"),d=document.querySelector("#ios-targeting-from"),i=document.querySelector("#android-targeting-form"),l=document.querySelector("#geo-targeting-tab"),u=document.querySelector("#geo-targeting-form");e.classList.add("toggle"),t.classList.add("d-none"),o.classList.add("d-none"),n.classList.add("disabled"),s.classList.add("overlay-open"),c.classList.add("disabled"),r.display="none",a.classList.add("disabled"),d.display="none",i.display="none",l.classList.add("disabled"),u.display="none"}));const a=document.querySelector("#closeForm");a&&a.addEventListener("click",(function(){const e=document.querySelector("#aside-form"),t=document.querySelector("#archive-btn"),o=document.querySelector("#update-form-shortcode"),n=document.querySelector("#openForm"),s=document.querySelector("#overlay-open"),c=document.querySelector("#pills-profile-tab"),r=document.querySelector("#limitation-form"),a=document.querySelector("#mobile-tab"),d=document.querySelector("#ios-targeting-from"),i=document.querySelector("#android-targeting-form"),l=document.querySelector("#geo-targeting-tab"),u=document.querySelector("#geo-targeting-form"),m=document.querySelector("#shortcode_id");e.classList.remove("toggle"),t.classList.remove("d-none"),o.classList.remove("d-none"),n.classList.remove("disabled"),s.classList.remove("overlay-open"),m.innerHTML="",c.classList.remove("disabled"),r.display="block",a.classList.remove("disabled"),d.display="block",i.display="block",l.classList.remove("disabled"),u.display="block";const h=document.getElementById("id_url_destination"),g=document.getElementById("id_url_titel"),p=document.getElementById("id_shortcode"),y=document.querySelector("#update-shortcode-url");h.value="",g.value="",p.value="",y.value="",m.innerHTML=""}))})();